---
description: 
globs: 
alwaysApply: false
---
# åç«¯æ¶æ„è®¾è®¡è§„èŒƒ

## ğŸ“ ç›®å½•ç»“æ„

```
backend/
â”œâ”€â”€ app/                          # åº”ç”¨æ ¸å¿ƒä»£ç 
â”‚   â”œâ”€â”€ __init__.py              # åŒ…åˆå§‹åŒ–
â”‚   â”œâ”€â”€ main.py                  # FastAPIåº”ç”¨å…¥å£
â”‚   â”œâ”€â”€ models.py                # æ•°æ®æ¨¡å‹å®šä¹‰
â”‚   â””â”€â”€ services/                # ä¸šåŠ¡é€»è¾‘å±‚
â”‚       â”œâ”€â”€ __init__.py
â”‚       â”œâ”€â”€ data_storage.py      # æ•°æ®å­˜å‚¨æœåŠ¡
â”‚       â””â”€â”€ resume_parser.py     # ç®€å†è§£ææœåŠ¡
â”œâ”€â”€ requirements.txt             # Pythonä¾èµ–
â”œâ”€â”€ venv/                        # è™šæ‹Ÿç¯å¢ƒ
â””â”€â”€ logs/                        # æ—¥å¿—æ–‡ä»¶
```

## ğŸ—ï¸ æ¶æ„è®¾è®¡

### æ ¸å¿ƒæ–‡ä»¶è¯´æ˜

#### [backend/app/main.py](mdc:backend/app/main.py)
- **èŒè´£**: FastAPIåº”ç”¨ä¸»å…¥å£ï¼Œè·¯ç”±å®šä¹‰
- **æ ¸å¿ƒåŠŸèƒ½**:
  - APIè·¯ç”±å®šä¹‰å’Œç«¯ç‚¹å®ç°
  - CORSé…ç½®å’Œä¸­é—´ä»¶è®¾ç½®
  - å¼‚å¸¸å¤„ç†å’Œå“åº”æ ¼å¼åŒ–
  - æ–‡ä»¶ä¸Šä¼ å’ŒAIç”Ÿæˆæ¥å£

#### [backend/app/models.py](mdc:backend/app/models.py)
- **èŒè´£**: æ•°æ®æ¨¡å‹å’ŒPydantic schemaå®šä¹‰
- **æ ¸å¿ƒæ¨¡å‹**:
  - `ResumeData`: ç®€å†æ•°æ®æ¨¡å‹
  - `ResumeFormData`: è¡¨å•æäº¤æ•°æ®æ¨¡å‹
  - `UploadResponse`: ä¸Šä¼ å“åº”æ¨¡å‹

#### [backend/app/services/resume_parser.py](mdc:backend/app/services/resume_parser.py)
- **èŒè´£**: ç®€å†æ–‡ä»¶è§£ææ ¸å¿ƒé€»è¾‘
- **åŠŸèƒ½æ¨¡å—**:
  - PDFæ–‡æœ¬æå–ï¼ˆæ”¯æŒOCRï¼‰
  - Wordæ–‡æ¡£è§£æ
  - è¡¨æ ¼æ ¼å¼è¯†åˆ«
  - æ­£åˆ™è¡¨è¾¾å¼å­—æ®µæå–
  - JSONæ ¼å¼æ•™è‚²/å·¥ä½œç»å†è§£æ

#### [backend/app/services/data_storage.py](mdc:backend/app/services/data_storage.py)
- **èŒè´£**: æ•°æ®å­˜å‚¨å’Œæ£€ç´¢æœåŠ¡
- **æ ¸å¿ƒåŠŸèƒ½**:
  - CSVæ–‡ä»¶è¯»å†™æ“ä½œ
  - æ•°æ®è¿‡æ»¤å’Œæœç´¢
  - ç®€å†è®°å½•CRUDæ“ä½œ
  - å·¥ä½œå¹´é™è®¡ç®—

#### [backend/requirements.txt](mdc:backend/requirements.txt)
- **èŒè´£**: Pythonä¾èµ–ç®¡ç†
- **å…³é”®ä¾èµ–**:
  - FastAPI + uvicorn (Webæ¡†æ¶)
  - pandas (æ•°æ®å¤„ç†)
  - python-docx (Wordæ–‡æ¡£)
  - pdfplumber + easyocr (PDFè§£æ)
  - requests (HTTPå®¢æˆ·ç«¯)

## ğŸ”§ å¼€å‘è§„èŒƒ

### APIè®¾è®¡è§„èŒƒ

#### ç«¯ç‚¹å‘½å
```python
# âœ… å¥½çš„å‘½å
@app.post("/upload")                    # ç®€å†ä¸Šä¼ 
@app.get("/resumes")                   # è·å–ç®€å†åˆ—è¡¨
@app.delete("/resumes/{unique_id}")    # åˆ é™¤æŒ‡å®šç®€å†
@app.get("/stats")                     # è·å–ç»Ÿè®¡æ•°æ®

# âŒ é¿å…çš„å‘½å
@app.post("/uploadResumeFile")         # è¿‡äºå†—é•¿
@app.get("/get_all_resumes")          # åŠ¨è¯å†—ä½™
```

#### å“åº”æ ¼å¼ç»Ÿä¸€
```python
# æˆåŠŸå“åº”
{
    "success": true,
    "message": "æ“ä½œæˆåŠŸ",
    "data": { ... }
}

# é”™è¯¯å“åº”
{
    "success": false,
    "message": "é”™è¯¯æè¿°",
    "error_code": "VALIDATION_ERROR"
}
```

### é”™è¯¯å¤„ç†è§„èŒƒ

#### ä½¿ç”¨HTTPException
```python
from fastapi import HTTPException

# âœ… æ ‡å‡†é”™è¯¯å¤„ç†
if not file_extension:
    raise HTTPException(
        status_code=400, 
        detail="ä»…æ”¯æŒ .docx å’Œ .pdf æ ¼å¼çš„æ–‡ä»¶"
    )

# âœ… åŒ…è£…å¼‚å¸¸å¤„ç†
try:
    result = process_file(file)
except Exception as e:
    raise HTTPException(
        status_code=500,
        detail=f"å¤„ç†æ–‡ä»¶æ—¶å‡ºé”™: {str(e)}"
    )
```

### æ•°æ®éªŒè¯è§„èŒƒ

#### ä½¿ç”¨Pydanticæ¨¡å‹
```python
from pydantic import BaseModel, validator
from typing import Optional

class ResumeData(BaseModel):
    å§“å: Optional[str] = ""
    å¹´é¾„: Optional[str] = ""
    
    @validator('å¹´é¾„')
    def validate_age(cls, v):
        if v and not v.isdigit():
            raise ValueError('å¹´é¾„å¿…é¡»æ˜¯æ•°å­—')
        return v
```

## ğŸš€ æ€§èƒ½ä¼˜åŒ–

### æ–‡ä»¶å¤„ç†ä¼˜åŒ–
- **ä¸´æ—¶æ–‡ä»¶ç®¡ç†**: ä½¿ç”¨`tempfile`ç¡®ä¿æ–‡ä»¶æ¸…ç†
- **å¼‚æ­¥å¤„ç†**: ä½¿ç”¨`async/await`å¤„ç†I/Oæ“ä½œ
- **å†…å­˜ä¼˜åŒ–**: å¤§æ–‡ä»¶åˆ†å—å¤„ç†ï¼Œé¿å…å†…å­˜æº¢å‡º
- **ç¼“å­˜ç­–ç•¥**: è§£æç»“æœç¼“å­˜ï¼Œæå‡é‡å¤è®¿é—®æ€§èƒ½

### æ•°æ®åº“æ“ä½œä¼˜åŒ–
- **æ‰¹é‡æ“ä½œ**: ä½¿ç”¨pandasæ‰¹é‡å¤„ç†CSVæ•°æ®
- **ç´¢å¼•ä¼˜åŒ–**: å¯¹å¸¸æŸ¥è¯¢å­—æ®µå»ºç«‹ç´¢å¼•æœºåˆ¶
- **åˆ†é¡µæŸ¥è¯¢**: å¤§æ•°æ®é›†åˆ†é¡µè¿”å›ï¼Œé¿å…ä¸€æ¬¡æ€§åŠ è½½

## ğŸ” è°ƒè¯•å’Œç›‘æ§

### æ—¥å¿—è®°å½•
```python
import logging

# é…ç½®æ—¥å¿—
logging.basicConfig(
    level=logging.INFO,
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s'
)

logger = logging.getLogger(__name__)

# ä½¿ç”¨æ—¥å¿—
logger.info(f"å¼€å§‹è§£ææ–‡ä»¶: {file.filename}")
logger.error(f"è§£æå¤±è´¥: {str(e)}")
```

### å¥åº·æ£€æŸ¥
```python
@app.get("/health")
async def health_check():
    """ç³»ç»Ÿå¥åº·æ£€æŸ¥ç«¯ç‚¹"""
    return {
        "status": "ok",
        "timestamp": datetime.now().isoformat(),
        "version": "2.0.0"
    }
```

## ğŸ”’ å®‰å…¨è§„èŒƒ

### æ–‡ä»¶ä¸Šä¼ å®‰å…¨
- **æ–‡ä»¶ç±»å‹éªŒè¯**: ä¸¥æ ¼æ£€æŸ¥æ–‡ä»¶æ‰©å±•åå’ŒMIMEç±»å‹
- **æ–‡ä»¶å¤§å°é™åˆ¶**: è®¾ç½®åˆç†çš„æ–‡ä»¶å¤§å°ä¸Šé™
- **è·¯å¾„å®‰å…¨**: é¿å…è·¯å¾„éå†æ”»å‡»
- **ä¸´æ—¶æ–‡ä»¶æ¸…ç†**: ç¡®ä¿ä¸´æ—¶æ–‡ä»¶åŠæ—¶åˆ é™¤

### APIå®‰å…¨
- **è¾“å…¥éªŒè¯**: ä½¿ç”¨Pydanticè¿›è¡Œä¸¥æ ¼çš„è¾“å…¥éªŒè¯
- **SQLæ³¨å…¥é˜²æŠ¤**: ä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢ï¼ˆè™½ç„¶å½“å‰ä½¿ç”¨CSVï¼‰
- **XSSé˜²æŠ¤**: å¯¹ç”¨æˆ·è¾“å…¥è¿›è¡Œè½¬ä¹‰å¤„ç†
- **CORSé…ç½®**: åˆç†é…ç½®è·¨åŸŸè®¿é—®ç­–ç•¥

## ğŸ“ˆ æ‰©å±•æ€§è®¾è®¡

### æ•°æ®å±‚æŠ½è±¡
```python
# æŠ½è±¡æ•°æ®è®¿é—®å±‚ï¼Œä¾¿äºåç»­æ‰©å±•åˆ°æ•°æ®åº“
class DataStorageInterface:
    def save_resume_data(self, data: ResumeData) -> bool:
        raise NotImplementedError
    
    def get_all_resumes(self) -> List[dict]:
        raise NotImplementedError

class CSVDataStorage(DataStorageInterface):
    # CSVå®ç°
    pass

class DatabaseStorage(DataStorageInterface):
    # æ•°æ®åº“å®ç°ï¼ˆæœªæ¥æ‰©å±•ï¼‰
    pass
```

### è§£æå™¨æ’ä»¶åŒ–
```python
# æ”¯æŒå¤šç§è§£æå™¨ï¼Œä¾¿äºæ‰©å±•æ–°æ ¼å¼
class ParserInterface:
    def parse(self, file_path: str) -> ResumeData:
        raise NotImplementedError

class WordParser(ParserInterface):
    # Wordæ–‡æ¡£è§£æ
    pass

class PDFParser(ParserInterface):
    # PDFæ–‡æ¡£è§£æ
    pass
```

